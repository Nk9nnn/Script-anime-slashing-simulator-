--// โหลดสคริปต์หลัก
loadstring(game:HttpGet("https://pastefy.app/75absC5Z/raw"))()
print("เริ่มทำงานสคริปต์")

--// ⚡ SETTINGS ⚡
local Settings = {
    AutoBoss = flase,
}

--// ⚡ SERVICES ⚡
local RS = game:GetService("ReplicatedStorage")
local Bridge = RS:WaitForChild("Remotes"):WaitForChild("Bridge")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

--// ฟังก์ชันได้ HumanoidRootPart
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end
local HRP = getHRP()
player.CharacterAdded:Connect(function(c)
    HRP = c:WaitForChild("HumanoidRootPart")
end)

--// ⚡ LIST บอส
local BossList = {
    ["Magelen"] = "Pirate Island",
    ["Dome"] = "Slayer Village",
    ["BlackFrieza"] = "Dragon Town",
    ["KesameAkat"] = "Leaf Village",
    ["ItacheAkat"] = "Leaf Village",
}

--// ⚡ DATA PROCESSING
local BossData = {}
local BossPriority = {}
local FirstBossWorld = nil

local starsFolder = workspace:WaitForChild("Server"):WaitForChild("Stars")
local enemiesFolder = workspace:WaitForChild("Server"):WaitForChild("Enemies")

for bossName, worldName in pairs(BossList) do
    if not FirstBossWorld then FirstBossWorld = worldName end

    local baseModel = starsFolder:WaitForChild(worldName)
    local enemyFolder = enemiesFolder:WaitForChild(worldName)

    if baseModel and baseModel:IsA("Model") and not baseModel.PrimaryPart then
        local firstPart = baseModel:FindFirstChildWhichIsA("BasePart")
        if firstPart then
            baseModel.PrimaryPart = firstPart
        end
    end

    BossData[bossName] = {World = worldName, Base = baseModel, EnemyFolder = enemyFolder}
    table.insert(BossPriority, bossName)
end

--// ⭐ ฟังก์ชันวาปไปฐานหลัก
local function TPToBase(baseModel)
    if baseModel and baseModel.PrimaryPart then
        HRP.CFrame = baseModel.PrimaryPart.CFrame + Vector3.new(0,5,0)
        task.wait(0.5)
    end
end

--// ⭐ วาปไปโลก
local function TPWorld(worldName)
    Bridge:FireServer("General","Teleport","Teleport",worldName)
    task.wait(0.5) -- รอโหลดโลก
end

--// ⭐ เช็คโลกปัจจุบัน
local function GetCurrentWorld()
    local closestWorld = nil
    local closestDist = math.huge
    local myPos = HRP.Position

    for _, data in pairs(BossData) do
        local base = data.Base
        if base and base.PrimaryPart then
            local dist = (myPos - base.PrimaryPart.Position).Magnitude
            if dist < closestDist then
                closestDist = dist
                closestWorld = data.World
            end
        end
    end

    return closestWorld
end

--// ⭐ ทีม
local function EquipTeamDmg()
    local args = {
        "General",
        "Fighters_Team",
        "Equip",
        "05-a045-4770-af94-abbee71aa04d"
    }
    Bridge:FireServer(unpack(args))
end

local function EquipTeamLuck()
    local args = {
        "General",
        "Fighters_Team",
        "Equip",
        "9e-706c-4e27-8c54-85955f358b81"
    }
    Bridge:FireServer(unpack(args))
end

--// ⭐ MAIN AutoBoss LOOP
task.spawn(function()
    while task.wait(0.5) do
        if not Settings.AutoBoss then continue end

        -- 1. เช็คโลกปัจจุบัน
        local currentWorld = GetCurrentWorld()
        if not currentWorld then
            TPWorld(FirstBossWorld)
            TPToBase(BossData[BossPriority[1]].Base)
            continue
        end

        -- 2. ตรวจบอสในโลก
        local TargetBoss, BossInfo, BossPart = nil, nil, nil
        for _, name in ipairs(BossPriority) do
            local info = BossData[name]
            local part = info.EnemyFolder:FindFirstChild(name)
            if part and part:IsA("BasePart") then
                TargetBoss = name
                BossInfo = info
                BossPart = part
                break
            end
        end

        -- 3. ถ้าไม่พบบอส → ใช้ Team Luck และกลับโลกแรก
        if not TargetBoss then
            EquipTeamLuck()
            TPWorld(FirstBossWorld)
            TPToBase(BossData[BossPriority[1]].Base)
            continue
        end

        -- 4. พบบอส → ใช้ Team Dmg และเดินหน้า 2 วินาที
        EquipTeamDmg()
        local forwardDir = HRP.CFrame.LookVector
        local moveTime = 2
        local startTime = tick()
        while tick() - startTime < moveTime do
            HRP.CFrame = HRP.CFrame + forwardDir * 5 -- เดินหน้า 5 stud ต่อรอบ
            task.wait(0.1)
        end

        -- 5. วาปไปโลกของบอส
        currentWorld = GetCurrentWorld()
        if currentWorld ~= BossInfo.World then
            TPWorld(BossInfo.World)
            task.wait(0.5)
            BossPart = BossInfo.EnemyFolder:FindFirstChild(TargetBoss)
            if not BossPart then continue end
        end

        -- 6. วาปขึ้นหัวบอส + ข้างหน้า
        if BossPart then
            local front = BossPart.CFrame.LookVector * 5
            HRP.CFrame = BossPart.CFrame + Vector3.new(0,5,0) + front
        end

        -- 7. รอจนบอสตาย (timeout 60 วิ)
        local timeout = 0
        repeat
            task.wait(0.2)
            timeout = timeout + 0.2
        until not BossInfo.EnemyFolder:FindFirstChild(TargetBoss) or timeout > 60

        -- 8. กลับโลกแรกและวาปฐาน
        TPWorld(FirstBossWorld)
        TPToBase(BossData[BossPriority[1]].Base)
    end
end)

--// ⭐ Auto Buy Trial Merchant
task.spawn(function()
    while true do
        pcall(function()
            Bridge:FireServer("General","Trial_Merchant","Buy","Slot4")
        end)
        task.wait(2)
    end
end)

print("สคริปต์ v2766")
