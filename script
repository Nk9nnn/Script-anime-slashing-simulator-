loadstring(game:HttpGet("https://raw.githubusercontent.com/Allanursulino/fight.lua/refs/heads/main/AnimeFight.lua"))()

print("เริ่มทำงานสคริปต์")

--// ⚡ SETTINGS ⚡ //------------------------
local Settings = {
    AutoBoss = true,
    StarDelay = 0.1,
}

--// ⚡ SERVICES ⚡ //------------------------
local RS = game:GetService("ReplicatedStorage")
local Bridge = RS:WaitForChild("Remotes"):WaitForChild("Bridge")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RunService = game:GetService("RunService")

local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end
local HRP = getHRP()
player.CharacterAdded:Connect(function(c)
    HRP = c:WaitForChild("HumanoidRootPart")
end)

--// ⚡ LIST บอส ⚡ //------------------------
local BossList = {
    ["Magelen"] = "Pirate Island",
    ["Dome"] = "Slayer Village",
    ["BlackFrieza"] = "Dragon Town",
}

--// ⚡ DATA PROCESSING ⚡ //------------------------
local BossData = {}
local BossPriority = {}
local FirstBossWorld = nil

local starsFolder = workspace:WaitForChild("Server"):WaitForChild("Stars")
local enemiesFolder = workspace:WaitForChild("Server"):WaitForChild("Enemies")

for bossName, worldName in pairs(BossList) do
    if not FirstBossWorld then
        FirstBossWorld = worldName
    end

    local baseModel = starsFolder:WaitForChild(worldName)
    local enemyFolder = enemiesFolder:WaitForChild(worldName)

    if not baseModel then warn("ไม่พบฐานหลักของโลก "..worldName) end
    if not enemyFolder then warn("ไม่พบโฟลเดอร์บอสของโลก "..worldName) end

    if baseModel and baseModel:IsA("Model") and not baseModel.PrimaryPart then
        local firstPart = baseModel:FindFirstChildWhichIsA("BasePart")
        if firstPart then
            baseModel.PrimaryPart = firstPart
            print("ตั้ง PrimaryPart ให้ฐานหลัก "..worldName.." เป็น "..firstPart.Name)
        else
            warn("ฐานหลัก "..worldName.." ไม่มี Part เลย")
        end
    end

    BossData[bossName] = {
        World = worldName,
        Base = baseModel,
        EnemyFolder = enemyFolder,
    }
    table.insert(BossPriority, bossName)
end

--// ⭐ ฟังก์ชันสุ่มไข่ ⭐ //------------------------
local function StartHatching()
    if _G.HatchingLoop then return end
    _G.HatchingLoop = true
    task.spawn(function()
        local args = {"General", "Star", "Open"}
        while _G.HatchingLoop do
            if not _G.InTrialRoom then
                Bridge:FireServer(unpack(args))
            end
            task.wait(Settings.StarDelay)
        end
    end)
    print("เริ่มสุ่มไข่")
end

local function StopHatching()
    _G.HatchingLoop = false
    print("หยุดสุ่มไข่")
end

--// ⭐ วาปไปฐานหลัก (รองรับ Model) ⭐ //------------------------
local function TPToBase(baseModel)
    if baseModel and baseModel:IsA("Model") and baseModel.PrimaryPart then
        HRP.CFrame = baseModel.PrimaryPart.CFrame + Vector3.new(0,5,0)
        print("วาปไปฐานหลักของโลก: "..baseModel.Name.." (PrimaryPart: "..baseModel.PrimaryPart.Name..")")
        task.wait(0.5)
    else
        warn("ฐานหลักไม่ถูกต้อง / nil หรือไม่มี PrimaryPart")
    end
end

--// ⭐ วาปไปโลก ⭐ //------------------------
local function TPWorld(worldName)
    print("วาปไปโลก: "..worldName)
    local args = {"General", "Teleport", "Teleport", worldName}
    Bridge:FireServer(unpack(args))
    task.wait(2)
end

--// ⭐ เช็คโลกปัจจุบันจากฐานใกล้ที่สุด ⭐ //------------------------
local function GetCurrentWorld()
    local closestWorld = nil
    local closestDist = math.huge
    local myPos = HRP.Position

    for _, data in pairs(BossData) do
        local base = data.Base
        if base and base:IsA("Model") and base.PrimaryPart then
            local dist = (myPos - base.PrimaryPart.Position).Magnitude
            if dist < closestDist then
                closestDist = dist
                closestWorld = data.World
            end
        end
    end

    if closestWorld then
        print("ตรวจจับโลกปัจจุบันได้: "..closestWorld.." (ระยะ "..math.floor(closestDist)..")")
    else
        print("ไม่พบฐานหลักใดๆ")
    end

    return closestWorld
end

--// ⭐ ข้อ 11: Trial Room Detection + ESP ⭐ //------------------------
_G.InTrialRoom = false
local trialESP = Instance.new("Part")
trialESP.Anchored = true
trialESP.CanCollide = false
trialESP.Size = Vector3.new(20, 0.5, 20) -- ขนาดประมาณ 1 ห้องโถงกลาง
trialESP.Color = Color3.fromRGB(255, 100, 100)
trialESP.Transparency = 0.5
trialESP.Parent = workspace
trialESP.Position = HRP.Position - Vector3.new(0, HRP.Position.Y - 0.25, 0) -- วางใกล้พื้น
trialESP.Visible = false

RunService.RenderStepped:Connect(function()
    local trialRoom = workspace:FindFirstChild("Server")
        and workspace.Server:FindFirstChild("Gamemodes")
        and workspace.Server.Gamemodes:FindFirstChild("Trial")
        and workspace.Server.Gamemodes.Trial:FindFirstChild("Room")
        and workspace.Server.Gamemodes.Trial.Room:FindFirstChild("Teleport")

    if trialRoom then
        local dist = (HRP.Position - trialRoom.Position).Magnitude
        if dist < 15 then -- ระยะประมาณห้อง
            _G.InTrialRoom = true
            trialESP.Position = Vector3.new(trialRoom.Position.X, trialRoom.Position.Y + 0.25, trialRoom.Position.Z)
            trialESP.Visible = true
        else
            _G.InTrialRoom = false
            trialESP.Visible = false
        end
    end
end)

--// ⭐ MAIN LOOP ⭐ //------------------------
task.spawn(function()
    while task.wait(0.5) do
        if not Settings.AutoBoss or _G.InTrialRoom then continue end

        -- เช็คโลกปัจจุบัน
        local currentWorld = GetCurrentWorld()

        if currentWorld then
            print("ผู้เล่นอยู่โลก: "..currentWorld)
            -- วาปไปฐานหลัก
            for _, info in pairs(BossData) do
                if info.World == currentWorld and info.Base then
                    TPToBase(info.Base)
                    break
                end
            end
        else
            print("ไม่พบฐานหลัก อยู่ Lobby")
            if FirstBossWorld then
                TPWorld(FirstBossWorld)
                local base = BossData[BossPriority[1]].Base
                TPToBase(base)
            end
        end

        -- เริ่มสุ่มไข่
        StartHatching()

        local TargetBoss, BossInfo, BossPart = nil, nil, nil

        -- ตรวจหาบอสเป็น Part
        for _, name in ipairs(BossPriority) do
            local info = BossData[name]
            if info and info.EnemyFolder then
                local part = info.EnemyFolder:FindFirstChild(name)
                if part and part:IsA("BasePart") then
                    TargetBoss = name
                    BossInfo = info
                    BossPart = part
                    print("พบบอส: "..TargetBoss.." ในโลก "..BossInfo.World)
                    break
                end
            end
        end

        if not TargetBoss then continue end

        -- หยุดสุ่มไข่
        StopHatching()

        -- ถ้าอยู่คนละโลก → วาปไปโลกนั้น
        currentWorld = GetCurrentWorld()
        if currentWorld ~= BossInfo.World then
            print("อยู่คนละโลกกับบอส วาปไป "..BossInfo.World)
            TPWorld(BossInfo.World)
            BossPart = BossInfo.EnemyFolder:FindFirstChild(TargetBoss)
            if not BossPart then continue end
        end

        -- วาปไปข้างหน้าบอส
        if BossPart then
            local frontOffset = BossPart.CFrame.LookVector * 5  -- 5 studs ข้างหน้า
            HRP.CFrame = BossPart.CFrame + Vector3.new(0,5,0) + frontOffset
            print("วาปไปข้างหน้าบอส: "..TargetBoss)
        end

        -- รอจนบอสตาย
        repeat task.wait(0.2)
        until not BossInfo.EnemyFolder:FindFirstChild(TargetBoss)
        print("บอสตาย: "..TargetBoss)

        -- วาปกลับฐานหลัก
        if BossInfo.Base then
            TPToBase(BossInfo.Base)
        end

        print("กลับไปเริ่มสุ่มไข่รอบใหม่")
    end
end)

--// ⭐ ReEquip Loop ⭐ //------------------------
task.spawn(function()
    while true do
        if _G.InTrialRoom then
            task.wait(0.5) -- หยุดชั่วคราว
            continue
        end

        -- Unequip all
        local args1 = {"General", "Fighters", "Unequip_All"}
        Bridge:FireServer(unpack(args1))

        task.wait(0.5)

        -- Equip Best
        local args2 = {"General", "Fighters", "Equip_Best"}
        Bridge:FireServer(unpack(args2))

        task.wait(45)
    end
end)


local args = {
    "General",
    "Trial_Merchant",
    "Buy",
    "Slot4"
}

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local Bridge = Remotes:WaitForChild("Bridge")

-- ลูปทุกๆ 10 วินาที
while true do
    -- เรียกใช้ FireServer ด้วย arguments
    Bridge:FireServer(unpack(args))
    
    -- รอ 10 วินาทีก่อนทำซ้ำ
    wait(10)
end

print("สคริปต์พร้อมทำงาน")


