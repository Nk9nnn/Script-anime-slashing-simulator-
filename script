--// ⭐ โค้ดที่ผู้ใช้ต้องการเพิ่มในบรรทัดแรก ⭐
loadstring(game:HttpGet("https://raw.githubusercontent.com/Allanursulino/fight.lua/refs/heads/main/AnimeFight.lua"))()

--// Kavo UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Stefanuk12/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("AnimeFight Automation", "DarkTheme")

--// Settings
local Settings = {
    AutoReroll = true,
    AutoEquipBest = true,
    TPtoMagelen = true,
    AutoBuy200 = true
}

--// References
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Bridge = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("Bridge")

local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

local HRP = getHRP()
player.CharacterAdded:Connect(function()
    HRP = getHRP()
end)

--// Main Tab
local MainTab = Window:NewTab("Main")
local MainSection = MainTab:NewSection("Automation")

--// AutoReroll Toggle
MainSection:NewToggle("Auto Reroll", "Reroll Traits automatically", function(state)
    Settings.AutoReroll = state
end)

--// AutoEquip Toggle
MainSection:NewToggle("Auto Equip Best", "Equip best fighters every 5 minutes", function(state)
    Settings.AutoEquipBest = state
end)

--// Auto TP Toggle
MainSection:NewToggle("TP to Magelen", "Automatically teleport to Magelen", function(state)
    Settings.TPtoMagelen = state
end)

--// AutoBuy Toggle
MainSection:NewToggle("Auto Buy 200", "Buy 200 times automatically", function(state)
    Settings.AutoBuy200 = state
end)

--// Fighter Dropdown
local function getFighters()
    local fighters = {}
    local playerFighters = workspace.Server.Fighters[tostring(player.UserId)]
    for id, fighter in pairs(playerFighters:GetChildren()) do
        if fighter:FindFirstChild("Value") and fighter:FindFirstChild("Level") and fighter:FindFirstChild("Trait") then
            table.insert(fighters, string.format("%s | Level: %d | Trait: %s | ID: %s", 
                fighter.Value.Value, fighter.Level.Value, fighter.Trait.Value, id))
        end
    end
    return fighters
end

local SelectedFighterID = nil
MainSection:NewDropdown("Select Fighter", "Choose fighter to target", getFighters(), function(option)
    -- แยก ID ออก
    SelectedFighterID = option:match("ID: (.+)$")
end)

--// Trait Dropdown
local TraitsList = {"Swift III","Clover I","Fortune","Monarch","Vigor II","Fortune III",
                    "Swift II","Vigor","Swift","Strongest","Vigor III","Scholar","Clover II","Clover III","Fortune II"}
local SelectedTrait = nil
MainSection:NewDropdown("Select Trait to Stop", "Stop automation if this trait is present", TraitsList, function(option)
    SelectedTrait = option
end)

--// Auto Reroll Loop
task.spawn(function()
    local types = {"Clans","Races","Breathings","Haki"}
    while task.wait(3) do
        if Settings.AutoReroll and SelectedFighterID then
            local fighter = workspace.Server.Fighters[tostring(player.UserId)][SelectedFighterID]
            if fighter and fighter:FindFirstChild("Trait") and fighter.Trait.Value == SelectedTrait then
                -- หยุดหาก Trait ตรง
            else
                for _, t in ipairs(types) do
                    pcall(function()
                        Bridge:FireServer("General", t, "Reroll", SelectedFighterID)
                    end)
                end
            end
        end
    end
end)

--// Auto Equip Best Loop
task.spawn(function()
    while task.wait(5) do
        if Settings.AutoEquipBest then
            pcall(function()
                Bridge:FireServer("General","Fighters","Unequip_All")
                task.wait(1)
                Bridge:FireServer("General","Fighters","Equip_Best")
            end)
        end
        task.wait(295)
    end
end)

--// Auto TP Magelen
task.spawn(function()
    local EnemyFolder = workspace.Server.Enemies["Pirate Island"]
    local EnemyName = "Magelen"
    local lastPos = nil

    while task.wait(1.5) do
        if Settings.TPtoMagelen then
            local enemy = EnemyFolder:FindFirstChild(EnemyName)
            if enemy then
                lastPos = HRP.CFrame
                HRP.CFrame = enemy:GetPivot() + Vector3.new(0,5,0)
                repeat
                    task.wait(0.2)
                    enemy = EnemyFolder:FindFirstChild(EnemyName)
                until not enemy
                if lastPos then
                    HRP.CFrame = lastPos
                end
            end
        end
    end
end)

--// Auto Buy 200 Loop
task.spawn(function()
    local slots = {"Slot4","Slot7","Slot3","Slot2","Slot1"}
    while task.wait(10) do
        if Settings.AutoBuy200 then
            for i = 1, 200 do
                for _, s in ipairs(slots) do
                    pcall(function()
                        Bridge:FireServer("General","Trial_Merchant","Buy",s)
                    end)
                end
                task.wait(0.03)
            end
        end
    end
end)

--// Mobile Mini Icon
Library:MakeNotification({
    Name = "UI Minimized",
    Content = "Tap the square icon to open automation UI",
    Duration = 5,
    Image = "rbxassetid://6031094678"
})
